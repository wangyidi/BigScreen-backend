<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.bigScreen.business.dao.ThirdPageMapper">

    <resultMap type="com.bigScreen.business.model.ThirdModel" id="BaseResultMap">
        <result column="sumNum" property="sumNum" jdbcType="INTEGER" />
        <result column="depName" property="depName" jdbcType="VARCHAR" />
        <result column="system" property="system" jdbcType="VARCHAR" />
        <result column="date" property="date" jdbcType="VARCHAR" />
        
    </resultMap>
    
	
	<resultMap type="com.bigScreen.business.model.ThirdModel" id="DeptResultMap">
        <result column="depName" property="depName" jdbcType="VARCHAR" />
        <collection property="recordList" ofType="com.bigScreen.business.model.ThirdDeptModel"  javaType="java.util.ArrayList" >
	        <result column="sumNum" property="sumNum" jdbcType="INTEGER" />
	        <result column="date" property="date" jdbcType="VARCHAR" />
        </collection>
    </resultMap>
	
	

    <select id="getSumBySystem"  resultMap="BaseResultMap" >
         select count(1) as sumNum,DEpt1_name as depName,system from inter_employee_view as a where system is not null group by a.system,a.DEpt1_name;


    </select>
    
    <select id="getPersonSumBySystemAndDate"  resultMap="BaseResultMap" parameterType="java.util.HashMap" >
		select count(1) sumNum,t.DEPT1_ID as depName,t.SYSTEM as system 
			from 
		inter_training_view t 
			left join inter_class_view c 
			on c.CLASS_ID = t.CLASS_ID 
		<where>
				 t.system is not null
			<if test="startDate!=null and startDate!=''">
			    <![CDATA[   and DATE_FORMAT(c.END_DATE, '%Y-%m')>=  #{startDate}  ]]>
			</if>
			<if test="endDate!=null and endDate!=''">
			    <![CDATA[  and DATE_FORMAT(c.END_DATE, '%Y-%m') <= #{endDate}   ]]>
			</if>
		</where>
 		 	GROUP BY t.system,t.DEPT1_ID
    </select>
    
    
    <select id="getDepGroupByMonth" resultMap="DeptResultMap" parameterType="java.util.HashMap">
    	 select t.DEPT1_ID as depName,count(1) as sumNum ,DATE_FORMAT(c.END_DATE,"%Y-%m") as date 
    	 	from 
		inter_training_view t left join inter_class_view c on c.CLASS_ID = t.CLASS_ID 
		<where>
			t.SYSTEM is not null and c.System is not null 
			<if test="startDate!=null and startDate!=''">
			    <![CDATA[   and DATE_FORMAT(c.END_DATE, '%Y-%m')>=  #{startDate}  ]]>
			</if>
			<if test="endDate!=null and endDate!=''">
			    <![CDATA[  and DATE_FORMAT(c.END_DATE, '%Y-%m') <= #{endDate}   ]]>
			</if>
		</where> 
		
		GROUP BY t.DEPT1_ID, DATE_FORMAT(c.END_DATE,"%Y-%m") 
		order by depName, date
    </select>

</mapper>